<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="Up1lF7t9sM_aTYAPC_lafCL4SPggmsMnUMisLS4EBQg" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victoria Junior Doctor Pay Calculator</title>
    <style>
        :root { --primary: #005eb8; --bg: #f4f6f8; --card: #ffffff; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); color: #1c1e21; padding: 20px; max-width: 1200px; margin: 0 auto; 
        }
        h2 { border-bottom: 2px solid #005eb8; padding-bottom: 10px; color: #005eb8; margin-top: 0; }
        .subtitle { font-size: 0.9em; color: #606770; margin-bottom: 20px; }
        
        .panel { background: var(--card); padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
        select { padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; width: 100%; max-width: 500px; }
        
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 1000px) { .grid-container { grid-template-columns: 1fr; } }
        
        .week-card { background: var(--card); border-radius: 8px; padding: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .week-header { font-weight: 700; color: var(--primary); margin-bottom: 15px; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        .day-row { 
            display: grid; 
            grid-template-columns: 35px 65px 65px 45px 50px 30px 30px 1fr; 
            gap: 6px; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .day-label { font-weight: 600; font-size: 13px; color: #444; }
        
        input[type="text"] { padding: 8px 2px; border: 1px solid #ccc; border-radius: 4px; text-align: center; width: 100%; font-family: monospace; font-size: 13px; }
        input[type="text"]:focus { border-color: var(--primary); outline: none; background: #e3f2fd; }
        
        input[type="number"] { padding: 8px 2px; border: 1px solid #ccc; border-radius: 4px; text-align: center; width: 100%; font-size: 13px; }
        
        .train-in { background: #fffde7; border-color: #fff59d !important; }
        .unrost-in { background: #ffebee; border-color: #ef9a9a !important; font-weight: bold; color: #c62828; }

        .status-cell { display: flex; flex-wrap: wrap; gap: 4px; }
        
        /* Badges */
        .badge { 
            font-size: 10px; font-weight: 700; text-transform: uppercase; 
            padding: 3px 6px; border-radius: 4px; color: white; white-space: nowrap;
            display: inline-block;
        }
        
        /* Badge Colors */
        .bg-ord { background-color: #2e7d32; } 
        .bg-night { background-color: #7b1fa2; } 
        .bg-wknd { background-color: #ef6c00; } 
        .bg-ot { background-color: #c62828; } 
        .bg-ph { background-color: #d81b60; } 
        .bg-flat { background-color: #455a64; } 
        .bg-fri { background-color: #0277bd; } 
        .bg-ph-off { background-color: #880e4f; border: 1px dashed #d81b60; }
        .bg-oncall { background-color: #00838f; }
        .bg-allow { background-color: #546e7a; }

        .payslip-box { background: white; border: 1px solid #ccc; margin-top: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 800px; margin-left: auto; margin-right: auto; }
        .payslip-head { background: #2c3e50; color: white; padding: 15px; font-weight: bold; text-align: center; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; background: #f8f9fa; padding: 12px; border-bottom: 2px solid #ddd; color: #555; font-size: 12px; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        td.amount { text-align: right; font-family: monospace; font-size: 15px; font-weight: 500; }
        .total-row td { background: #f8f9fa; font-weight: bold; font-size: 16px; border-top: 2px solid #2c3e50; color: #2c3e50; }
        
        .header-labels span { font-size: 10px; color: #888; text-transform: uppercase; text-align: center; display: block; }

        /* FAQ Section Styles */
        .faq-box { margin-top: 40px; max-width: 800px; margin-left: auto; margin-right: auto; }
        .faq-title { color: var(--primary); margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .faq-q { font-weight: bold; color: #333; margin-top: 15px; margin-bottom: 5px; }
        .faq-a { color: #555; line-height: 1.5; margin-bottom: 15px; font-size: 14px; }
        .disclaimer { text-align:center; padding: 20px; font-size: 11px; color: #888; margin-top: 30px; border-top: 1px solid #eee; }

/* --- NAVIGATION MENU --- */
    .navbar {
        background-color: #2c3e50; /* Dark Slate */
        overflow: hidden;
        border-radius: 6px;
        margin-bottom: 25px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .navbar a {
        float: left;
        display: block;
        color: #f2f2f2;
        text-align: center;
        padding: 12px 20px;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: background 0.3s;
    }

    .navbar a:hover {
        background-color: #ddd;
        color: black;
    }

    /* Active State Colors */
    .navbar a.active-home { background-color: #555; color: white; }
    .navbar a.active-vic { background-color: #005eb8; color: white; } /* Navy */
    .navbar a.active-nsw { background-color: #d32f2f; color: white; } /* Red */
    .navbar a.active-qld { background-color: #800000; color: white; } /* Maroon */

    /* Mobile Responsive */
    @media screen and (max-width: 600px) {
        .navbar a {
            float: none;
            width: 100%;
            text-align: left;
            border-bottom: 1px solid #3e5062;
        }
    }
        
    </style>
</head>
<body>
<nav class="navbar">
    <a href="https://invisiblejunior.github.io/junior-doctor-pay-calculator/index.html" class="active-home">Home</a>
    <a href="https://invisiblejunior.github.io/junior-doctor-pay-calculator/vic/">VIC</a>
    <a href="https://invisiblejunior.github.io/junior-doctor-pay-calculator/nsw/">NSW</a>
    <a href="https://invisiblejunior.github.io/junior-doctor-pay-calculator/qld/">QLD</a>
</nav>
    
    <h2>Victoria Junior Doctor Pay Calculator</h2>

    <div class="panel">
        <label><strong>Select Classification:</strong></label><br>
        <select id="roleSelector" onchange="updateUI()">
            <optgroup label="Interns & Residents (Base 38h)">
                <option value="HM11">Intern (HM11)</option>
                <option value="HM12">HMO Year 2 (HM12)</option>
                <option value="HM13">HMO Year 3 (HM13)</option>
            </optgroup>
            <optgroup label="Registrars (Base 43h)">
                <option value="HM25">Registrar Yr 1 (HM25)</option>
                <option value="HM26">Registrar Yr 2 (HM26)</option>
                <option value="HM27">Registrar Yr 3 (HM27)</option>
                <option value="HM28">Registrar Yr 4 (HM28)</option>
                <option value="HM29">Registrar Yr 5 (HM29)</option>
                <option value="HM30">Registrar Yr 6+ (HM30)</option>
            </optgroup>
            <optgroup label="Medical Officers (Base 38h)">
                <option value="HM14">Medical Officer Yr 1 (HM14)</option>
                <option value="HM15">Medical Officer Yr 2 (HM15)</option>
                <option value="HM16">Medical Officer Yr 3 (HM16)</option>
                <option value="HM17">Medical Officer Yr 4 (HM17)</option>
                <option value="HM18">Medical Officer Yr 5 (HM18)</option>
                <option value="HM19">Solely Admin (HM19)</option>
                <option value="HM20">Medical Officer Yr 6+ (HM20)</option>
            </optgroup>
            <optgroup label="Senior Medical Officers (Base 38h)">
                <option value="HM21">Senior MO Yr 1 (HM21)</option>
                <option value="HM22">Senior MO Yr 2 (HM22)</option>
                <option value="HM23">Senior MO Yr 3+ (HM23)</option>
            </optgroup>
        </select>
        <div id="roleHint" style="margin-top:10px; font-size:13px; color:#666;"></div>
    </div>

    <div class="grid-container">
        <div class="week-card" id="week1"></div>
        <div class="week-card" id="week2"></div>
    </div>

    <div class="payslip-box">
        <div class="payslip-head">ESTIMATED PAYSLIP</div>
        <table id="payslipTable">
            <thead>
                <tr>
                    <th width="50%">Pay Component</th>
                    <th width="15%">Units</th>
                    <th width="15%">Rate</th>
                    <th width="20%" style="text-align:right">Total</th>
                </tr>
            </thead>
            <tbody id="payslipBody"></tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="3">GROSS TOTAL</td>
                    <td class="amount" id="grossTotal">$0.00</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="panel faq-box">
        <h3 class="faq-title">Frequently Asked Questions</h3>
        
              <div class="faq-q">How do I use this page?</div>
        <div class="faq-a">
            Grab your official rostered hours and days and enter them into the calculator with the relevant rostered start and finish time. Then add in your unrostered overtime. 
            Tick the box for <strong>OC</strong> (stand-by oncall) or <strong>PH</strong> (public holiday). 
            If no hours are entered on a public holiday, it will be counted as ‘Public Holiday not worked’.
            <br><br>
            For registrars, ensure that you enter your training time as well, as that significantly changes your pay.
            Overtime is paid at x1.5 for the first 4 hours, and x2.0 for the excess
        </div>

    

    <div class="disclaimer">
        * This tool is an unofficial estimator created for educational purposes.<br>
        * It is not legal or financial advice.<br>
        * Calculations are based on the Doctors in Training (Victorian Public Health Sector) Enterprise Agreement 2022-2026.<br>
        * Please verify all figures with your official payslip and hospital payroll department.
    </div>

<script>
    // === 1. DATA (March 2025 Rates) ===
    const RATES = {
        HM11: { weekly: 1638.49, divisor: 38, type: "HMO", cme: 74.60 },
        HM12: { weekly: 1742.45, divisor: 38, type: "HMO", cme: 90.90 },
        HM13: { weekly: 1888.94, divisor: 38, type: "HMO", cme: 90.90 },
        HM25: { weekly: 2481.70, divisor: 43, type: "REG", cme: 118.90 },
        HM26: { weekly: 2623.33, divisor: 43, type: "REG", cme: 118.90 },
        HM27: { weekly: 2723.30, divisor: 43, type: "REG", cme: 118.90 },
        HM28: { weekly: 2859.75, divisor: 43, type: "REG", cme: 118.90 },
        HM29: { weekly: 3253.02, divisor: 43, type: "REG", cme: 118.90 },
        HM30: { weekly: 3415.81, divisor: 43, type: "REG", cme: 118.90 },
        HM14: { weekly: 2305.31, divisor: 38, type: "MO", cme: 90.90 },
        HM15: { weekly: 2450.07, divisor: 38, type: "MO", cme: 90.90 },
        HM16: { weekly: 2593.86, divisor: 38, type: "MO", cme: 90.90 },
        HM17: { weekly: 2738.20, divisor: 38, type: "MO", cme: 90.90 },
        HM18: { weekly: 2882.42, divisor: 38, type: "MO", cme: 90.90 },
        HM19: { weekly: 2882.42, divisor: 38, type: "MO", cme: 90.90 },
        HM20: { weekly: 3055.36, divisor: 38, type: "MO", cme: 90.90 },
        HM21: { weekly: 3239.63, divisor: 38, type: "SMO", cme: 90.90 },
        HM22: { weekly: 3401.67, divisor: 38, type: "SMO", cme: 90.90 },
        HM23: { weekly: 3571.58, divisor: 38, type: "SMO", cme: 90.90 }
    };

    const SHIFT_PENALTIES = { "HMO": 40.96, "MO": 57.63, "REG": 62.04, "SMO": 80.99 };
    const ON_CALL_RATES = { "MF": 38.60, "PH": 77.20 };
    const DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    const MEAL_ALLOWANCE = 11.13;
    const OT_15_CAP = 4.0; 
    let ot15Tracker = 0; 

    // === 2. INIT ===
    function init() {
        renderWeek('week1', 0);
        renderWeek('week2', 7);
        updateUI();
    }

    function renderWeek(containerId, offset) {
        const container = document.getElementById(containerId);
        container.innerHTML = `
            <div class="week-header">${offset===0 ? "Week 1" : "Week 2"}</div>
            <div class="day-row header-labels">
                <span>Day</span>
                <span>Start</span>
                <span>Finish</span>
                <span>Train</span>
                <span>U.OT</span>
                <span title="On Call?">OC</span>
                <span>PH</span>
                <span>Status</span>
            </div>
        `;

        DAYS.forEach((day, index) => {
            const i = offset + index;
            const div = document.createElement('div');
            div.className = 'day-row';
            div.innerHTML = `
                <span class="day-label">${day}</span>
                <input type="text" id="start_${i}" placeholder="0800" onblur="formatTime(this)" onchange="calculate()">
                <input type="text" id="end_${i}" placeholder="1700" onblur="formatTime(this)" onchange="calculate()">
                <input type="number" id="train_${i}" class="train-in" placeholder="" tabindex="-1" min="0" max="10" step="0.5" onchange="calculate()">
                <input type="number" id="unrost_${i}" class="unrost-in" placeholder="" tabindex="-1" min="0" max="15" step="0.5" onchange="calculate()" title="Unrostered Overtime Hours">
                <input type="checkbox" id="oncall_${i}" tabindex="-1" onchange="calculate()" title="Rostered On Call">
                <input type="checkbox" id="ph_${i}" tabindex="-1" onchange="calculate()" title="Public Holiday">
                <div id="status_${i}" class="status-cell"></div>
            `;
            container.appendChild(div);
        });
    }

    function updateUI() {
        const roleKey = document.getElementById('roleSelector').value;
        const r = RATES[roleKey];
        const hint = document.getElementById('roleHint');
        if (r.divisor === 43) {
            hint.innerHTML = `<strong>${roleKey}</strong>: Base pays 43 hours/week.`;
            document.querySelectorAll('.train-in').forEach(el => el.disabled = false);
        } else {
            hint.innerHTML = `<strong>${roleKey}</strong>: Base pays 38 hours/week.`;
            document.querySelectorAll('.train-in').forEach(el => {
                el.disabled = true;
                el.value = '';
            });
        }
        calculate();
    }

    function formatTime(input) {
        let val = input.value.replace(/[^0-9]/g, '');
        if (!val) return;
        if (val.length <= 2) {
            if (parseInt(val) < 10) val = "0" + parseInt(val);
            input.value = val + ":00";
        } else if (val.length >= 3) {
            if (val.length === 3) val = "0" + val;
            input.value = val.substring(0,2) + ":" + val.substring(2,4);
        }
        calculate();
    }

    // === 3. CALCULATION ENGINE ===
    function calculate() {
        const roleKey = document.getElementById('roleSelector').value;
        const rateData = RATES[roleKey];
        const hourlyRate = rateData.weekly / rateData.divisor;
        const standardHours = rateData.divisor; 
        const standardDay = standardHours / 5; 
        const cmeTotal = rateData.cme * 2; 
        const flatPenRate = SHIFT_PENALTIES[rateData.type] || 0;

        let buckets = {
            "Ordinary":                 { total: 0, hrs: 0, displayRate: hourlyRate, css: "bg-ord" },
            "Ordinary (Wknd 1.5x)":     { total: 0, hrs: 0, displayRate: hourlyRate * 1.5, css: "bg-wknd" },
            "Ordinary (PH 2.5x)":       { total: 0, hrs: 0, displayRate: hourlyRate * 2.5, css: "bg-ph" },
            "PH Not Worked (1.0x)":     { total: 0, hrs: 0, displayRate: hourlyRate, css: "bg-ph-off" }, 
            "Night Duty (1.25x)":       { total: 0, hrs: 0, displayRate: hourlyRate * 1.25, css: "bg-night" }, 
            "Training Time":            { total: 0, hrs: 0, displayRate: hourlyRate, css: "bg-fri" },
            "Fri Shift Pen (25%)":      { total: 0, hrs: 0, displayRate: hourlyRate * 0.25, css: "bg-fri" }, 
            "Shift Allowance (Flat)":   { total: 0, count: 0, displayRate: flatPenRate, css: "bg-flat" }, 
            "On-Call (Mon-Fri)":        { total: 0, count: 0, displayRate: ON_CALL_RATES["MF"], css: "bg-oncall" },
            "On-Call (Wknd/PH)":        { total: 0, count: 0, displayRate: ON_CALL_RATES["PH"], css: "bg-oncall" },
            "Overtime (1.5x)":          { total: 0, hrs: 0, displayRate: hourlyRate * 1.5, css: "bg-ot" },
            "Overtime (2.0x)":          { total: 0, hrs: 0, displayRate: hourlyRate * 2.0, css: "bg-ot" },
            "Overtime (PH 2.5x)":       { total: 0, hrs: 0, displayRate: hourlyRate * 2.5, css: "bg-ot" },
            "Meal Allowance":           { total: 0, count: 0, displayRate: MEAL_ALLOWANCE, css: "bg-allow" },
            "CME Allowance":            { total: cmeTotal, count: 1, displayRate: cmeTotal, css: "bg-allow" }
        };

        let totalHoursAccrued = 0;
        ot15Tracker = 0; 
        const fortnightThreshold = standardHours * 2; 

        for(let k=0; k<14; k++) document.getElementById(`status_${k}`).innerHTML = '';

        for (let i = 0; i < 14; i++) {
            const startVal = document.getElementById(`start_${i}`).value;
            const endVal = document.getElementById(`end_${i}`).value;
            const trainVal = parseFloat(document.getElementById(`train_${i}`).value) || 0;
            const unrostVal = parseFloat(document.getElementById(`unrost_${i}`).value) || 0;
            const isPH = document.getElementById(`ph_${i}`).checked;
            const isOnCall = document.getElementById(`oncall_${i}`).checked;
            
            let statusCell = document.getElementById(`status_${i}`);
            let dayStats = { ord: 0, ot: 0, night: 0, wknd: 0, friPen: 0, flatPen: 0, phOff: 0, onCall: 0, phWorked: 0 };
            const dayName = DAYS[i % 7];

            // 1. ON CALL
            if (isOnCall) {
                dayStats.onCall = 1;
                if (dayName === 'Sat' || dayName === 'Sun' || isPH) {
                    buckets["On-Call (Wknd/PH)"].total += ON_CALL_RATES["PH"];
                    buckets["On-Call (Wknd/PH)"].count += 1;
                } else {
                    buckets["On-Call (Mon-Fri)"].total += ON_CALL_RATES["MF"];
                    buckets["On-Call (Mon-Fri)"].count += 1;
                }
            }

            // 2. PH NOT WORKED
            if (isPH && !startVal && !endVal && trainVal === 0 && unrostVal === 0) {
                let phHours = standardDay;
                buckets["PH Not Worked (1.0x)"].hrs += phHours;
                buckets["PH Not Worked (1.0x)"].total += (phHours * hourlyRate);
                totalHoursAccrued += phHours;
                dayStats.phOff = phHours;
                renderBadges(statusCell, dayStats);
                continue; 
            }

            // 3. ROSTERED SHIFT
            let rosteredFinishedHour = 0; 
            let hasRostered = false;

            if (startVal && endVal) {
                hasRostered = true;
                let sParts = startVal.split(':');
                let eParts = endVal.split(':');
                if (sParts.length === 2 && eParts.length === 2) {
                    let start = new Date(2000, 0, 1, sParts[0], sParts[1]);
                    let end = new Date(2000, 0, 1, eParts[0], eParts[1]);
                    let isOvernight = false;
                    if (end < start) {
                        isOvernight = true;
                        end.setDate(end.getDate() + 1);
                    }

                    let rawDur = (end - start) / 36e5; 
                    if ((rawDur + unrostVal) > 11) {
                        buckets["Meal Allowance"].count++;
                        buckets["Meal Allowance"].total += MEAL_ALLOWANCE;
                    }

                    let sHourRaw = start.getHours() + start.getMinutes()/60;
                    let eHourRaw = end.getHours() + end.getMinutes()/60;
                    if (isOvernight) eHourRaw += 24;
                    rosteredFinishedHour = eHourRaw; 

                    let isNightDuty = false;
                    if (isOvernight) isNightDuty = true;
                    if (sHourRaw >= 0 && sHourRaw < 6.5) isNightDuty = true;

                    if (!isNightDuty && !isPH && ['Mon','Tue','Wed','Thu'].includes(dayName)) {
                        if (eHourRaw > 18) {
                             buckets["Shift Allowance (Flat)"].count += 1;
                             buckets["Shift Allowance (Flat)"].total += flatPenRate;
                             dayStats.flatPen = 1;
                        }
                    }

                    let segments = [];
                    if (isOvernight) {
                        let midnight = new Date(2000, 0, 2, 0, 0);
                        let part1 = (midnight - start) / 36e5;
                        let part2 = (end - midnight) / 36e5;
                        if (part1 > 0) segments.push({ dayIdx: i, hours: part1, sH: sHourRaw, eH: 24 });
                        if (part2 > 0) segments.push({ dayIdx: i + 1, hours: part2, sH: 0, eH: eHourRaw - 24 });
                    } else {
                        segments.push({ dayIdx: i, hours: rawDur, sH: sHourRaw, eH: eHourRaw });
                    }
                    
                    segments.forEach(seg => {
                        let actualDayIdx = seg.dayIdx % 7; 
                        let segPH = (seg.dayIdx < 14) ? document.getElementById(`ph_${seg.dayIdx}`).checked : false;
                        processSegment(actualDayIdx, seg.hours, false, true, hourlyRate, segPH, buckets, totalHoursAccrued, fortnightThreshold, rateData.weekly, seg.sH, seg.eH, isNightDuty, flatPenRate, dayStats, false);
                        totalHoursAccrued += seg.hours;
                    });
                }
            }

            // 4. TRAINING
            if (trainVal > 0) {
                 processSegment(i % 7, trainVal, true, false, hourlyRate, isPH, buckets, totalHoursAccrued, fortnightThreshold, rateData.weekly, 0, 0, false, flatPenRate, dayStats, false);
                 totalHoursAccrued += trainVal;
            }

            // 5. UNROSTERED OT
            if (unrostVal > 0) {
                let uStart = hasRostered ? rosteredFinishedHour : 8; 
                let uEnd = uStart + unrostVal;
                processSegment(i % 7, unrostVal, false, false, hourlyRate, isPH, buckets, totalHoursAccrued, fortnightThreshold, rateData.weekly, uStart, uEnd, false, flatPenRate, dayStats, true);
            }

            renderBadges(statusCell, dayStats, trainVal);
        }

        renderPayslip(buckets, hourlyRate);
    }

    function processSegment(dayIdx, hours, isTraining, isTimeSpecific, hourlyRate, isPH, buckets, currentTotalHours, threshold, weeklyRate, sHour, eHour, isNightDuty, flatPenRate, dayStats, isUnrostered) {
        let hrsOrd = 0;
        let hrsOT = 0;
        
        if (isUnrostered) {
            hrsOT = hours;
            hrsOrd = 0;
        } else {
            if (currentTotalHours >= threshold) hrsOT = hours;
            else if (currentTotalHours + hours > threshold) {
                hrsOrd = threshold - currentTotalHours;
                hrsOT = hours - hrsOrd;
            } else hrsOrd = hours;
        }

        if (hrsOrd > 0) {
            if (isTraining) {
                buckets["Training Time"].hrs += hrsOrd;
                buckets["Training Time"].total += (hrsOrd * hourlyRate);
            } else {
                const dayName = DAYS[dayIdx];
                if (isPH) {
                    buckets["Ordinary (PH 2.5x)"].hrs += hrsOrd;
                    buckets["Ordinary (PH 2.5x)"].total += (hrsOrd * hourlyRate * 2.5);
                    dayStats.phWorked += hrsOrd;
                } else if (dayName === 'Sat' || dayName === 'Sun') {
                    buckets["Ordinary (Wknd 1.5x)"].hrs += hrsOrd;
                    buckets["Ordinary (Wknd 1.5x)"].total += (hrsOrd * hourlyRate * 1.5);
                    dayStats.wknd += hrsOrd;
                } else if (isNightDuty) {
                    buckets["Night Duty (1.25x)"].hrs += hrsOrd;
                    buckets["Night Duty (1.25x)"].total += (hrsOrd * hourlyRate * 1.25);
                    dayStats.night += hrsOrd;
                } else {
                    buckets["Ordinary"].hrs += hrsOrd;
                    buckets["Ordinary"].total += (hrsOrd * hourlyRate);
                    dayStats.ord += hrsOrd;

                    if (isTimeSpecific && dayName === 'Fri') {
                        let pStart = Math.max(sHour, 18);
                        let pEnd = Math.min(eHour, 24);
                        if (pEnd > pStart) {
                            let loadHrs = pEnd - pStart;
                            let ratio = hrsOrd / hours; 
                            let finalLoad = loadHrs * ratio;
                            buckets["Fri Shift Pen (25%)"].hrs += finalLoad;
                            buckets["Fri Shift Pen (25%)"].total += (finalLoad * hourlyRate * 0.25);
                            dayStats.friPen += finalLoad;
                        }
                    }
                }
            }
        }

        if (hrsOT > 0) {
            dayStats.ot += hrsOT;
            const dayName = DAYS[dayIdx];
            if (isPH) {
                buckets["Overtime (PH 2.5x)"].hrs += hrsOT;
                buckets["Overtime (PH 2.5x)"].total += (hrsOT * hourlyRate * 2.5);
            } else if (dayName === 'Sun') {
                buckets["Overtime (2.0x)"].hrs += hrsOT;
                buckets["Overtime (2.0x)"].total += (hrsOT * hourlyRate * 2.0);
            } else {
                let available15 = Math.max(0, OT_15_CAP - ot15Tracker);
                let to15 = Math.min(hrsOT, available15);
                let to20 = hrsOT - to15;
                ot15Tracker += to15;

                buckets["Overtime (1.5x)"].hrs += to15;
                buckets["Overtime (1.5x)"].total += (to15 * hourlyRate * 1.5);
                
                buckets["Overtime (2.0x)"].hrs += to20;
                buckets["Overtime (2.0x)"].total += (to20 * hourlyRate * 2.0);
            }
        }
    }

    function renderBadges(cell, stats, trainOnly=0) {
        let html = '';
        if(stats.onCall > 0) html += `<span class="badge bg-oncall">ON CALL</span> `;
        if(stats.phOff > 0) html += `<span class="badge bg-ph-off">PH OFF: ${stats.phOff.toFixed(1)}h</span> `;
        if(trainOnly > 0) html += `<span class="badge" style="background:#0277bd">TRAIN: ${trainOnly}h</span> `;

        if (stats.ord > 0) html += `<span class="badge bg-ord">ORD: ${stats.ord.toFixed(1)}h</span> `;
        if (stats.phWorked > 0) html += `<span class="badge bg-ph">PH WORK: ${stats.phWorked.toFixed(1)}h</span> `;
        if (stats.wknd > 0) html += `<span class="badge bg-wknd">WKND: ${stats.wknd.toFixed(1)}h</span> `;
        if (stats.night > 0) html += `<span class="badge bg-night">NIGHT: ${stats.night.toFixed(1)}h</span> `;
        if (stats.ot > 0) html += `<span class="badge bg-ot">OT: ${stats.ot.toFixed(1)}h</span> `;
        if (stats.friPen > 0) html += `<span class="badge bg-fri">FRI-PEN: ${stats.friPen.toFixed(1)}h</span> `;
        if (stats.flatPen > 0) html += `<span class="badge bg-flat">FLAT PEN</span> `;
        cell.innerHTML = html;
    }

    function renderPayslip(buckets, baseRate) {
        const tbody = document.getElementById('payslipBody');
        tbody.innerHTML = '';
        let grandTotal = 0;

        for (const [name, data] of Object.entries(buckets)) {
            if (data.total <= 0.01) continue;
            
            let rateTxt;
            if (name.includes("Flat") || name.includes("Meal") || name.includes("CME") || name.includes("On-Call")) 
                rateTxt = `$${(data.displayRate || 0).toFixed(2)}`;
            else 
                rateTxt = `$${(data.displayRate || 0).toFixed(2)}`;

            let unitTxt = "";
            if (name.includes("Meal") || name.includes("Flat") || name.includes("CME") || name.includes("On-Call")) 
                unitTxt = Math.round(data.count);
            else if (data.hrs > 0) 
                unitTxt = data.hrs.toFixed(2) + " h";

            const badgeHtml = `<span class="badge ${data.css}" style="margin-right:8px; font-size:11px;">${name}</span>`;

            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${badgeHtml}</td><td>${unitTxt}</td><td>${rateTxt}</td><td class="amount">$${data.total.toFixed(2)}</td>`;
            tbody.appendChild(tr);
            grandTotal += data.total;
        }

        document.getElementById('grossTotal').innerText = '$' + grandTotal.toFixed(2);
    }

    init();
</script>

</body>
</html>










